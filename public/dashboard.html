<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard | Big Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --accent: #38bdf8;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #334155;
        }
        h1 { margin: 0; font-weight: 600; letter-spacing: -1px; }
        p.subtitle { color: var(--text-muted); margin-top: 5px; }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            border: 1px solid #334155;
            transition: transform 0.2s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); }
        
        h3 { margin-top: 0; color: var(--text-muted); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        /* Footer */
        footer { text-align: center; margin-top: 50px; color: var(--text-muted); font-size: 0.8rem; }
    </style>
</head>
<body>

    <header>
        <h1>üö¥‚Äç‚ôÇÔ∏è Urban Mobility Intelligence</h1>
        <p class="subtitle">An√°lisis de Big Data en Tiempo Real - MongoDB Atlas & Vercel</p>
    </header>

    <div class="grid-container">
        <div class="card">
            <h3>Distribuci√≥n de Usuarios</h3>
            <div class="chart-container">
                <canvas id="chartUsers"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>Actividad por Hora</h3>
            <div class="chart-container">
                <canvas id="chartHours"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>Top 10 Estaciones</h3>
            <div class="chart-container">
                <canvas id="chartStations"></canvas>
            </div>
        </div>

        <div class="card">
            <h3>Tendencia Diaria</h3>
            <div class="chart-container">
                <canvas id="chartDays"></canvas>
            </div>
        </div>
    </div>

    <footer>
        Desarrollado por Juan Pablo para la materia Big Data - 2025
    </footer>

    <script>
        // Configuraci√≥n Global de gr√°ficas para que se vean "Dark Mode"
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = '#334155';
        
        function crearGrafica(id, tipo, labels, datos, label, colores) {
            new Chart(document.getElementById(id), {
                type: tipo,
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: datos,
                        backgroundColor: colores,
                        borderColor: tipo === 'line' ? '#38bdf8' : null,
                        borderWidth: 2,
                        borderRadius: 5,
                        tension: 0.4 // Hace las l√≠neas curvas y suaves
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        async function cargarDatos() {
            try {
                // 1. Usuarios (Donut chart se ve m√°s moderno)
                const res1 = await fetch('/api/users');
                const data1 = await res1.json();
                crearGrafica('chartUsers', 'doughnut', 
                    data1.map(d => d._id), data1.map(d => d.total), 
                    'Usuarios', ['#38bdf8', '#818cf8']); // Azules ne√≥n

                // 2. Horas
                const res2 = await fetch('/api/hours');
                const data2 = await res2.json();
                crearGrafica('chartHours', 'bar', 
                    data2.map(d => d._id + ":00"), data2.map(d => d.total), 
                    'Viajes', '#2dd4bf'); // Verde agua

                // 3. Estaciones (Horizontal bar es mejor para leer nombres largos)
                const res3 = await fetch('/api/stations?limit=10');
                const data3 = await res3.json();
                new Chart(document.getElementById('chartStations'), {
                    type: 'bar',
                    data: {
                        labels: data3.map(d => d.name),
                        datasets: [{
                            label: 'Salidas',
                            data: data3.map(d => d.total),
                            backgroundColor: '#fbbf24', // Amarillo
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y', // Barras horizontales
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });

                // 4. D√≠as
                const res4 = await fetch('/api/days');
                const data4 = await res4.json();
                crearGrafica('chartDays', 'line', 
                    data4.slice(0, 20).map(d => d._id), data4.slice(0, 20).map(d => d.total), 
                    'Tendencia', '#f472b6'); // Rosa

            } catch (error) { console.error(error); }
        }
        cargarDatos();
    </script>
</body>
</html>
